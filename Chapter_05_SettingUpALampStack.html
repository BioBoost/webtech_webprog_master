<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Webtechnology and Webprogramming - Setting up a LAMP stack</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/moderno.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->

        <link rel="stylesheet" href="css/custom.kulab.nico.css">
	</head>

	<body>

		<div class="reveal">
            <img id="logo" src="assets/Logo_labICT.png" alt="Logo labICT">  

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

                <section>
                    <section>
                        <h1>Webtechnology and Webprogramming</h1>
                        <h3>Setting up a LAMP stack</h3>
                        <p><a href="http://labict.be">labict.be</a></p>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>The Virtual Machine</h2>

                        <div>
                            <img height="300" src="assets/C05/VirtualBox.jpg" alt="Virtual Box Logo">
                        </div>
                    </section>

                    <section>
                        <h3>@Kulab</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Select at least 256MB of RAM</li>
                                <li>Create two network adapters
                                    <ul>
                                        <li>A NAT adapter (accessing the Internet)</li>
                                        <li>A host only adapter (local access)</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div>
                            <img height="100" src="assets/C05/VB_NetworkAdapters.png" alt="Virtual Box Network adapters for Kulab">
                        </div>

                        <div class="alignleft">
                            <ul>
                                <li>Install Ubuntu 12.04 - 64bit - Server Edition</li>
                            </ul>
                        </div>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Basic Server Setup</h2>
                    </section>

                    <section>
                        <h3>Configuring the network interfaces</h3>

                        <div class="alignleft">
                            <ul>
                                <li>You can chech the current active and configured network interfaces using the <code>ifconfig command</code></li>
                                <li>The network interfaces are configured based on the content of the <code>&quot;/etc/network/interfaces&quot;</code> file</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo nano /etc/network/interfaces
                        </code></pre>
                    </section>

                    <section>
                        <h3>Configuring the network interfaces @ Kulab</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Your network interfaces should be configured for DHCP</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface (NAT)
auto eth0
iface eth0 inet dhcp

# The secondary network interface (Host-only)
auto eth1
iface eth1 inet dhcp
                        </code></pre>
                    </section>

                    <section>
                        <h3>Configuring a network interface with a static IP address</h3>

                        <pre><code data-trim>
# The primary network interface
auto eth0
iface eth0 inet static
    address 10.0.0.1
    netmask 255.255.255.0
    network 10.0.0.0
    broadcast 10.0.0.255
    gateway 10.0.0.254

                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Lines beginning with the word &quot;auto&quot; are used to identify the physical interfaces to be brought up when ifup is run with the -a option (this option is used by the system boot scripts)</li>
                                <li>You can bring interfaces down with <code>ifdown &lt;int&gt;</code> and back up using <code>ifup &lt;int&gt;</code> where &lt;int&gt; is <code>eth0, eth1, ...</code></li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3>Configuring the hostname</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Setting a hostname allows for easy identification when logged in.</li>
                                <li>Note that the system's hostname has no relationship to websites or email services hosted on it, aside from providing a name for the system itself</li>
                                <li>Your hostname should not be "www" or anything too generic.</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
echo &quot;webtech&quot; &gt; /etc/hostname
hostname -F /etc/hostname
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>When logging out and back in your shell should reflect the changed hostname</li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3>Configuring the hostname</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Update the host file to reflect new hostname</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
nano /etc/hosts
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Add the following lines to the files</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
127.0.0.1   webtech
127.0.0.1   webtech.be
127.0.0.1   webtech.org
                        </code></pre>
                    </section>

                    <section>
                        <h3>Update list of software packages</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Update list of software packages (updates the list of available packages and their versions)</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
apt-get update
                        </code></pre>
                    </section>

                    <section>
                        <h3>Upgrade currently installed packages</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Upgrade currently installed packages with the newest versions available</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
apt-get upgrade
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Or you can also use dist-upgrade to carry out a more intelligent upgrade</li>
                                <li>Basically upgrade will only upgrade existing packages from one version to another. It will not install or remove packages, even if doing so is required to upgrade others.</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
apt-get dist-upgrade
                        </code></pre>
                    </section>

                    <section>
                        <h3>Configuring the server timezone</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Configuring the server timezone</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
dpkg-reconfigure tzdata
                        </code></pre>
                    </section>

                    <section>
                        <h3>Enable open SSH server</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Enable open SSH server</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
tasksel
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Select OpenSSH server</li>
                                <li>SSH can be configured by altering <code>/etc/ssh/sshd_config</code>
                                    <ul>
                                        <li>You should for example not permit root login from ssh</li>
                                    </ul>
                                </li>
                                <li>Dont forget to restart the SSH service after making changes</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo service ssh restart
                        </code></pre>
                    </section>

                    <section>
                        <h3>Connecting via SSH</h3>

                        <div class="alignleft">
                            <ul>
                                <li>You should now be able to connect to your machine using SSH</li>
                                <li>You can use a utility like putty to connect to the VM
                                    <ul>
                                        <li>Connect to the host-only network (192.168.x.x)</li>
                                        <li>Use port 22</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>User accounts</h2>
                    </section>

                    <section>
                        <h3>Adding a system admin user</h3>

                        <pre><code data-trim>
useradd -r -m -s /bin/bash nico
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>-r to create system account (no expire)</li>
                                <li>-m to create home dir</li>
                                <li>-s specify bash as shell</li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3>Password</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Set the password for the accounts (without a password a user account will be in locked status)</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
passwd nico
                        </code></pre>
                    </section>

                    <section>
                        <h3>Sudoer</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Add user to sudo users</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
usermod -a -G sudo nico
                        </code></pre>
                    </section>

                    <section>
                        <h3>Locking root</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Make sure to login as system user (nico)</li>
                                <li>Now we lock the root account so it cant be used for logging in</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo usermod -L root
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>From now on you should always login using one of the admin accounts</li>
                                <li>The root account can be reenabled (if ever needed) by setting a password using <code>passwd root</code></li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3>Configuring SSH to use key-pair authentication</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Generate user keys (Windows or host machine) if you dont already have one or want to create a seperate one for this machine</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
cd ~/.ssh
ssh-keygen -t rsa
                        </code></pre>
                    </section>

                    <section>
                        <h3>Configuring SSH to use key-pair authentication</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Copy the public key to the server</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
scp id_rsa.pub nico@&lt;ip-address&gt;:/tmp/id_rsa.pub
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Watch out with windows tab completion !
                                    <ul>
                                        <li>&quot;id_rsa.pub&quot; may be changed to &quot;./id_rsa.pub&quot; which is literally used as the filename.</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3>Configuring SSH to use key-pair authentication</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Create a .ssh dir for the user (here nico as example) if none exists yet</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
mkdir /home/nico/.ssh
chmod 0700 /home/nico/.ssh
                        </code></pre>
                    </section>

                    <section>
                        <h3>Configuring SSH to use key-pair authentication</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Add the key to the authorized keys on the server</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo cat /tmp/id_rsa.pub >> /home/nico/.ssh/authorized_keys
sudo rm /tmp/id_rsa.pub
sudo chown -R nico:nico /home/nico/.ssh
sudo chmod -R 0700 /home/nico/.ssh
                        </code></pre>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Installing and configuring Apache</h2>
                    </section>

                    <section>
                        <h3>Installing apache</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Install apache and php using apt-get</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo apt-get install apache2 php5 libapache2-mod-php5
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>You should now have a directory /var/www</li>
                                <li>Surf to your domain name or ip address and check if the site is online</li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3>Need to knows</h3>

                        <div class="alignleft">
                            <ul>
                                <li>You can restart apache using the following command if ever needed</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo service apache2 restart
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>The PHP config file can be found as /etc/php5/apache2/php.ini</li>
                                <li>Main apache config, sites-available and sites-enabled can be found in /etc/apache2/</li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3>Configure Apache Rewrite</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Make sure that apacha is allowing .htaccess files to override permissions by changing the line 'AllowOverride None' to 'AllowOverride All'</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo nano /etc/apache2/sites-available/default
                        </code></pre>

                        <pre><code data-trim>
&lt;Directory /var/www/&gt;
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Order allow,deny
        allow from all
&lt;/Directory&gt;
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Restart the apache service </li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo service apache2 restart
                        </code></pre>
                    </section>
                    
                    <section>
                        <h3>Adding system accounts to the www-data group</h3>

                        <div class="alignleft">
                            <ul>
                                <li>This allows the users to cd into the /var/www dirs</li>
                                <li>Add nico to the www-data group</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo usermod -a -G www-data nico
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Display the groups a user is assigned to</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
id nico
                        </code></pre>
                    </section>
                    
                    <section>
                        <h3>Setting up MySql</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Install MySQL server</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo apt-get install mysql-server mysql-client php5-mysql
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Enter a root password when requested</li>
                            </ul>
                        </div>
                    </section>
                    
                    <section>
                        <h3>Setting up PhpMyAdmin</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Install PhpMyAdmin using apt-get</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo apt-get install phpmyadmin
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Select apache2 when asked
                                    <ul>
                                        <li>The first password that needs to be provided is the root password of the database.</li>
                                        <li>The second password is the password that is attached to the phpmyadmin user account.</li>
                                    </ul>
                                </li>
                                <li>Select to configure database. If you miss you can restart config using <code>sudo dpkg-reconfigure phpmyadmin</code></li>
                                <li>You should now be able to access phpmyadmin via http://&lt;server-ip-address/phpmyadmin</li>
                            </ul>
                        </div>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Firewall rules</h2>
                    </section>

                    <section>
                        <h3>Install Uncomplicated Firewall</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Install ufw using apt-get</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo apt-get install ufw
                        </code></pre>
                    </section>

                    <section>
                        <h3>Allow SSH and HTTP</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Configure ufw to allow ssh and http access</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo ufw allow ssh
sudo ufw allow http
                        </code></pre>
                    </section>

                    <section>
                        <h3>Activate UFW</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Enable the firewall</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo ufw enable
                        </code></pre>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Mail Server</h2>
                    </section>

                    <section>
                        <h3>Setting up postfix for sending of emails</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Install postfix using apt-get</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo apt-get install postfix
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Pick the "Internet site" configuration</li>
                                <li>Configure the system mail name as "webtech.be" (without the quotes)</li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3>Further configuration of the postfix</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Open the postfix configuration file</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo nano /etc/postfix/main.cf
                        </code></pre>

                        <pre><code data-trim>
myhostname = xionix
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
# No local delivery
mydestination =
# Send all mail to xionix.be relay host (live domain in our case)
relayhost = xionix.be
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
                        </code></pre>
                        
                    </section>

                    <section>
                        <h3>Test your setup</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Make sure you can telnet to the localhost on port 25</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
telnet localhost 25
                        </code></pre>
                        
                    </section>

                    <section>
                        <h3>Test your setup</h3>

                        <div class="alignleft">
                            <ul>
                                <li>Install a CLI mail client</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo apt-get install mailutils
                        </code></pre>
                        
                    </section>

                    <section>
                        <h3>Test your setup</h3>

                        <div class="alignleft">
                            <ul>
                                <li>You can send mail using the following command</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
echo &quot;MESSAGE&quot; | mail -s &quot;SUBJECT&quot; &lt;email_address&gt;
                        </code></pre>
                        
                    </section>

                    <section>
                        <h3>Attachments</h3>

                        <div class="alignleft">
                            <ul>
                                <li>If you want to send attachments you need uuencode (part of sharutils)</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
sudo apt-get install sharutilst
                        </code></pre>

                        <div class="alignleft">
                            <ul>
                                <li>Sending mail with attachments (you need to specify the filename twice!)</li>
                            </ul>
                        </div>

                        <pre><code data-trim>
uuencode &lt;attachedfile&gt; &lt;attachedfile&gt; | mail -s &quot;My Attachment&quot; -- nico@webtech.be
                        </code></pre>
                        
                    </section>
                </section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
